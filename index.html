<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <title>Dev-Meetup</title>
    <meta property="og:title" content="Dev-Meetup" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://github.com/dev-meetup/dev-meetup.github.io/raw/master/static/images/ic_event_note_black_48dp_2x.png" />
    <meta property="og:locale" content="ko_KR" />
    <meta property="og:site_name" content="Dev-Meetup" />
    <meta property="og:description" content="개발자 밋업/세미나 모음" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.2.0/fullcalendar.css"/>
    <link rel="stylesheet" href="./static/style/material-kit.css"/>
    <link rel="stylesheet" href="./static/style/materialFullCalendar.css"/>
    <link rel="stylesheet" href="./static/style/custom.css"/>

    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-92973130-1', 'auto');
        ga('send', 'pageview');
    </script>

</head>

<body id="body">

<!-- Navbar -->
<nav class="navbar navbar-info">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" id="navbar-menu" style="display: none;" data-toggle="collapse" data-target="#example-navbar-primary">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="./">
                <img alt="Brand" src="./static/images/devmeetup.png"></a>
        </div>

        <div class="collapse navbar-collapse" >
            <ul class="nav navbar-nav navbar-right">
                <li class="active" id="btn-calendar">
                    <a href="#">
                        <i class="fa fa-calendar" aria-hidden="true"></i>
                        Calendar
                    </a>
                </li>
                <li id="btn-list">
                    <a href="#">
                        <i class="fa fa-list" aria-hidden="true"></i>
                        List
                    </a>
                </li>
                <li id="btn-graph">
                    <a href="#">
                        <i class="fa fa-bar-chart" aria-hidden="true"></i>
                        Graph
                    </a>
                </li>
                <li id="btn-comment">
                    <a href="#">
                        <i class="fa fa-commenting-o" aria-hidden="true"></i>
                        Comment
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>
<!-- End Navbar -->

<div class="wrapper" >
    <div class="main">
        <div class="container" id="container">
        </div>
    </div>
</div>


<footer class="footer" id="footer" style="display: none">
    <div class="container">
        <nav class="pull-left">
            <ul>
                <li>
                    <a href="https://github.com/dev-meetup/dev-meetup.github.io">
                        <i class="fa fa-github-alt" aria-hidden="true"></i>
                        github
                    </a>
                </li>
                <li>
                    <a href="https://github.com/dev-meetup/dev-meetup.github.io/blob/master/LICENSE">
                        MIT Licenses
                    </a>
                </li>
                <li>
                    I am because we are
                </li>
            </ul>
        </nav>
        <div class="copyright pull-right">
            © 2017, made with <i class="material-icons footer-icon">favorite</i> by <a class="footer-href" href="https://dev-meetup.github.io">dev-meetup.github.io.</a>
        </div>
    </div>
</footer>


</body>

<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment-with-locales.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.2.0/fullcalendar.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.2.0/locale-all.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react-dom.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react-with-addons.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.24/browser.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mobile-detect/1.3.5/mobile-detect.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js"></script>
<script src="./static/js/material.min.js"></script>
<script src="./static/js/nouislider.min.js"></script>

<script type="text/babel">
    let EventColor = {
        "FREE_CURRENT":"#03A9F4",
        "FREE_AGO":"#B3E5FC",
        "PAY_CURRENT":"#D73964",
        "PAY_AGO":"#FFDBE5"
    };
    let EventPayType = {"PAY":2, "FREE":1, "UNKNOWN":0};
    class CalendarView extends React.Component {
        render() {
            return (
                <div id="calendar">
                    <div id='fullcalendar'></div>
                </div>
            );
        }
    }

    class ListView extends React.Component {
        render() {
            return (
                <div id="calendar">
                    <div id='fullcalendar'></div>
                </div>
            );
        }
    }

    class CommentView extends React.Component {
        render() {
            return (<div id="disqus_thread"></div>);
        }
    }

    class GraphView extends React.Component {
        render() {
            return (<div id="graph">
                    <div className="col-xs-6">
                        <div className="panel panel-info">
                            <div className="panel-heading">Event Tag Chart</div>
                            <div className="panel-body">
                                <canvas id="tag_chart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div className="col-xs-6">
                        <div className="panel panel-info">
                            <div className="panel-heading"> Month Chart </div>
                            <div className="panel-body">
                                <canvas id="month_chart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div className="col-xs-6">
                        <div className="panel panel-info">
                            <div className="panel-heading">Week Day Chart</div>
                            <div className="panel-body">
                                <canvas id="weekday_chart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div className="col-xs-6">
                        <div className="panel panel-info">
                            <div className="panel-heading">Hour Chart</div>
                            <div className="panel-body">
                                <canvas id="hour_chart"></canvas>
                            </div>
                        </div>
                    </div>


                </div>
            );
        }
    }

    document.onload = onLoad();

    function onLoad(){
        var md = new MobileDetect(window.navigator.userAgent);
        if(md.mobile()){
            drawListView({
                left: null ,
                center: 'title',
                right: null
            });
            hideListBorder();
            hideFooter();
            hideNavBarMenu();
            removePaddingForMobile();
        }
        else{
            drawCalendarView();
            showFooter();
        }
    }

    function removePaddingForMobile(){
        $("#container").css('padding-right', '0px');
        $("#container").css('padding-left', '0px');
    }

    function hideFooter(){
        $("#footer").css('display', 'none');
    }

    function showFooter(){
        $("#footer").css('display', 'block');
    }

    function hideNavBarMenu(){
        $("#navbar-menu").css('display', 'none');
    }

    function showNavBarMenu(){
        $("#navbar-menu").css('display', 'block');
    }

    function hideListBorder(){
        $(".fc-list-view").css('border-style', 'none');
    }

    function drawCalendarView(){
        ReactDOM.render(<CalendarView />, document.getElementById('container'));
        drawCalendarMonth();
    }

    function drawListView(header){
        ReactDOM.render(<ListView />, document.getElementById('container'));
        drawCalendarList(header);

    }

    function drawCommentView(){
        ReactDOM.render(<CommentView />, document.getElementById('container'));
        var disqus_config = function () {
            this.page.url = 'https://dev-meetup.github.io/';
            this.page.identifier = 'https://dev-meetup.github.io/';
            this.page.title = 'Dev-Meetup';
        };

        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = 'https://dev-meetup.disqus.com/embed.js';
            s.setAttribute('data-timestamp', + new Date());
            (d.head || d.body).appendChild(s);
        })();

    }

    function drawGraphView(){
        ReactDOM.render(<GraphView />, document.getElementById('container'));
        drawGraph();
    }

    function  drawGraph() {

        let url = "data/statistic.json";
        let success_func = function (result) {
            console.log(result);
            drawTagChart(result.tag);
            drawWeekDayChart(result.weekday);
            drawMonthChart(result.month);
            drawHourChart(result.st_hour, result.ed_hour)


        };
        $.ajax({
            url: url,
            method: 'GET',
            success: success_func,
            error: null,
            complete: null
        });
    }


    let chartColors = {
        red: 'rgb(255, 99, 132)',
        orange: 'rgb(255, 159, 64)',
        yellow: 'rgb(255, 205, 86)',
        green: 'rgb(75, 192, 192)',
        blue: 'rgb(54, 162, 235)',
        purple: 'rgb(153, 102, 255)',
        grey: 'rgb(201, 203, 207)'
    };

    function drawTagChart(raw_tag_data){
        console.log(raw_tag_data);
        let keys = _.keys(raw_tag_data).slice(0, 10);
        let values = _.values(raw_tag_data).slice(0, 10);
        let tag_ctx = document.getElementById("tag_chart");

        let pieData = {
            datasets: [{
                data: values,
                backgroundColor: [
                    chartColors.red,
                    chartColors.orange,
                    chartColors.yellow,
                    chartColors.green,
                    chartColors.blue,
                ]
            }],
            labels:keys
        };

        new Chart(tag_ctx,{
            type: 'doughnut',
            data: pieData,
            options: {
                title: {
                    display: true,
                    text: 'Top 10 Tags'
                },
                responsive: true,
                animation:{
                    animateScale: true,
                    animateRotate: true
                },
                legend: {
                    display: true,
                    position: 'bottom'
                },}
        });
    }

    function drawWeekDayChart(raw_weekday_data){
        console.log(raw_weekday_data);
        let weekday_keys = _.sortBy(_.keys(raw_weekday_data));
        let weekday_values = [];
        let i = 0;
        for(i=0; i<weekday_keys.length; i++){
            weekday_values.push(raw_weekday_data[weekday_keys[i]]);
            switch (parseInt(weekday_keys[i])) {
                case 0:
                    weekday_keys[i] = "MON";
                    break;
                case 1:
                    weekday_keys[i] = "TUE";
                    break;
                case 2:
                    weekday_keys[i] = "WED";
                    break;
                case 3:
                    weekday_keys[i] = "THU";
                    break;
                case 4:
                    weekday_keys[i] = "FRI";
                    break;
                case 5:
                    weekday_keys[i] = "SAT";
                    break;
                case 6:
                    weekday_keys[i] = "SUN";
                    break;
            }
        }

        let weekday_ctx = document.getElementById("weekday_chart");
        new Chart(weekday_ctx, {
            type: 'line',
            data: {
                labels: weekday_keys,
                datasets: [{
                    backgroundColor: transparentize('#03A9F4'),
                    borderColor: '#03A9F4',
                    data: weekday_values,
                    label: 'WeekDay Event Count',
                    fill: 'start'
                }]
            },
            options: {
                elements: {
                    line: {
                        tension: 0.000001
                    }
                }
            }
        });
    }

    function drawMonthChart(raw_month_data){

        let month_keys = _.sortBy(_.keys(raw_month_data));
        let month_values = [];
        let i = 0;
        for(i=0; i<month_keys.length; i++){
            month_values.push(raw_month_data[month_keys[i]]);
        }
        console.log(month_keys);
        console.log(month_values);
        let month_ctx = document.getElementById("month_chart");

        new Chart(month_ctx, {
            type: 'line',
            data: {
                labels: month_keys,
                datasets: [{
                    backgroundColor: transparentize('#03A9F4'),
                    borderColor:  '#03A9F4',
                    data: month_values,
                    label: 'Monthly Event Count',
                    fill: 'start'
                }]
            },
            options: {
                elements: {
                    line: {
                        tension: 0.000001
                    }
                }
            }
        });
    }


    function drawHourChart(raw_st_hour_data, raw_ed_hour_data){
        let hour_keys = _.sortBy(_.keys(raw_st_hour_data));
        let st_hour_values = [];
        let ed_hour_values = [];
        let i = 0;
        for(i=0; i<hour_keys.length; i++){
            st_hour_values.push(raw_st_hour_data[hour_keys[i]]);
            ed_hour_values.push(raw_ed_hour_data[hour_keys[i]]);
        }

        console.log(st_hour_values);
        console.log(ed_hour_values);
        let hour_ctx = document.getElementById("hour_chart");

        new Chart(hour_ctx, {
            type: 'line',
            data: {
                labels: hour_keys,
                datasets: [
                    {
                        backgroundColor: transparentize(chartColors.red),
                        borderColor:  chartColors.red,
                        data: st_hour_values,
                        label: 'Start Hour Event Count',
                        fill: 'start'
                    },
                    {
                        backgroundColor: transparentize('#03A9F4'),
                        borderColor:  '#03A9F4',
                        data: ed_hour_values,
                        label: 'End Hour Event Count',
                        fill: 'start'
                    }]
            },
            options: {
                elements: {
                    line: {
                        tension: 0.000001
                    }
                }
            }
        });
    }



    function transparentize(color, opacity) {
        var alpha = opacity === undefined ? 0.5 : 1 - opacity;
        return Color(color).alpha(alpha).rgbString();
    }
    function drawCalendarMonth() {
        $('#fullcalendar').fullCalendar({

            header: {
                left: null ,
                center: 'title',
                right: 'prev, next today'
            },
            views: {},
            locale: 'ko',
            defaultView: 'month',
            defaultDate: moment().format(),
            navLinks: true,
            timeFormat: 'H:mm',
            editable: false,
            eventLimit: true,
            events: function (start, end, timezone, callback) {
                var date = $('#fullcalendar').fullCalendar('getDate');
                $.getJSON( "data/events-" + date.format('YYYY-MM') + ".json", function( result ) {

                    for(var i=0; i<result.events.length; i++) {
                        var start = result.events[i].start;
                        var eventPayType = isEventPayType(result.events[i].pay_amount);
                        if (moment(start).isAfter(moment())) {
                            if(eventPayType === EventPayType.PAY){
                                result.events[i]['color'] = EventColor.PAY_CURRENT
                            }else{
                                result.events[i]['color'] = EventColor.FREE_CURRENT
                            }
                        }
                        else{
                            if(eventPayType === EventPayType.PAY){
                                result.events[i]['color'] = EventColor.PAY_AGO
                            }
                            else{
                                result.events[i]['color'] = EventColor.FREE_AGO
                            }
                        }
                    }
                    callback(result.events);
                });
            },
            eventClick: function(calEvent, jsEvent, view) {
                window.open(calEvent.url, '_blank');
                return false;
            },
            eventMouseover: function(calEvent, domEvent) {


                closePopovers();
                var title ="<a href='" + calEvent.url + "'>" + calEvent.title + "</a>";
                var content = '<ul>';
                content +="<li>" + $.fullCalendar.formatDate(calEvent.start, 'HH:mm') + " ~ " + $.fullCalendar.formatDate(calEvent.end, 'HH:mm') + "</li>";
                content +="<li>" + calEvent.address + "</li>";
                content +="<li>" + calEvent.tags + "</li>";

                var eventPayType = isEventPayType(calEvent.pay_amount);
                if(eventPayType === EventPayType.FREE){
                    content +="<li>가격 : 무료</li>";
                }
                else if(eventPayType === EventPayType.PAY){
                    content +="<li>가격 : "+calEvent.pay_amount+"원</li>";
                }
                else{
                    content +="<li>가격 : 알 수 없음</li>";
                }

                let gcStart =  moment(calEvent.start).format('YYYYMMDD') + 'T' +  moment(calEvent.start).format('HHmmss');
                let gcEnd = moment(calEvent.end).format('YYYYMMDD') + 'T' +  moment(calEvent.end).format('HHmmss');
                let calendarLink = "https://calendar.google.com/calendar/render?action=TEMPLATE&text=" + calEvent.title + "&dates=" + gcStart + "/" + gcEnd + "&ctz=Asia/Seoul&details=" + calEvent.tags + "&location=" + calEvent.address;
                content +="<li><a target='_blank' href='" + calendarLink + "'>캘린더에 추가</a></li>";
                $(domEvent.currentTarget).popover({
                    title:title,
                    content:content,
                    html:true,
                    container: 'body'
                }).popover('show');
            }

        });
    }

    function drawCalendarList(header) {
        var md = new MobileDetect(window.navigator.userAgent);
        var height ='auto';
        var contentHeight = 'auto';
        if(md.mobile()){
            height = window.innerHeight - 120;
        }
        $('#fullcalendar').fullCalendar({
            header: header,
            views: {},
            locale: 'ko',
            height:height,
            contentHeight:contentHeight,
            defaultView: 'listMonth',
            defaultDate: moment().format(),
            timeFormat: 'H:mm',
            navLinks: true,
            editable: false,
            eventLimit: true,
            events: function (start, end, timezone, callback) {
                $.getJSON("data/events.json", function( result ) {

                    for(var i=0; i<result.events.length; i++) {
                        var start = result.events[i].start;
                        var eventPayType = isEventPayType(result.events[i].pay_amount);
                        if (moment(start).isAfter(moment())) {
                            if(eventPayType === EventPayType.PAY){
                                result.events[i]['color'] = EventColor.PAY_CURRENT
                            }else{
                                result.events[i]['color'] = EventColor.FREE_CURRENT
                            }
                        }
                        else{
                            if(eventPayType === EventPayType.PAY){
                                result.events[i]['color'] = EventColor.PAY_AGO
                            }
                            else{
                                result.events[i]['color'] = EventColor.FREE_AGO
                            }
                        }
                    }
                    callback(result.events);
                });
            },
            eventClick: function(calEvent, jsEvent, view) {
                window.open(calEvent.url, '_blank');
                return false;
            }

        });
    }

    $("#btn-calendar").click(function(e){
        $("#btn-list").removeClass('active');
        $("#btn-comment").removeClass('active');
        $("#btn-graph").removeClass('active');
        $(this).addClass('active');
        drawCalendarView();
    });


    $("#btn-list").click(function(e){
        $("#btn-comment").removeClass('active');
        $("#btn-calendar").removeClass('active');
        $("#btn-graph").removeClass('active');
        $(this).addClass('active');
        drawListView();
    });

    $("#btn-comment").click(function(e){
        $("#btn-list").removeClass('active');
        $("#btn-calendar").removeClass('active');
        $("#btn-graph").removeClass('active');
        $(this).addClass('active');
        drawCommentView();
    });

    $("#btn-graph").click(function(e){
        $("#btn-list").removeClass('active');
        $("#btn-calendar").removeClass('active');
        $("#btn-comment").removeClass('active');
        $(this).addClass('active');
        drawGraphView();
    });



    var hammertime = new Hammer(document.getElementById("body"));
    hammertime.on('swipeleft', function(ev) {
        $('#fullcalendar').fullCalendar('next');
    });

    hammertime.on('swiperight', function(ev) {
        $('#fullcalendar').fullCalendar('prev');
    });

    function closePopovers() {
        $('.popover').not(this).popover('hide');
    }

    $('body').on('click', function (e) {
        closePopovers();
    });

    function isEventPayType(payAmount){
        if(payAmount !== undefined){
            if(payAmount === "0") {
                //무료
                return EventPayType.FREE;
            }
            else{
                //유료
                return EventPayType.PAY;
            }
        }
        return EventPayType.UNKNOWN;
    }

</script>
</html>
